{
  "variables": {
    "home": "{{env `HOME`}}",
    "docker_version": "1.8.2-0",
    "compose_version": "1.4.2",
    "dnsdock_version": "v1.10.0",
    "registry_version": "2.1.1"
  },
  "push": {
    "name": "kaluzki/docker"
  },
  "builders": [{
    "type": "virtualbox-ovf",
    "source_path": "{{user `home`}}/.vagrant.d/boxes/ubuntu-VAGRANTSLASH-trusty64/20151008.0.2/virtualbox/box.ovf",
    "ssh_username": "vagrant",
    "ssh_password": "vagrant",
    "ssh_wait_timeout": "30s",
    "vboxmanage": [
      ["modifyvm", "{{.Name}}", "--memory", "2048"],
      ["modifyvm", "{{.Name}}", "--cpus", "2"]
    ],
    "shutdown_command": "echo 'packer' | sudo -S shutdown -P now"
  }],
  "provisioners": [
    {
      "type": "shell",
      "environment_vars": [
        "DOCKER_VERSION={{user `docker_version`}}",
        "COMPOSE_VERSION={{user `compose_version`}}",
        "DNSDOCK_VERSION={{user `dnsdock_version`}}",
        "REGISTRY_VERSION={{user `registry_version`}}"
      ],
      "execute_command": "echo 'vagrant' | {{.Vars}} sudo -E -S bash '{{.Path}}'",
      "scripts": [
        "{{template_dir}}/../../scripts/common/vagrant.sh",
        "{{template_dir}}/../../scripts/ubuntu/oh-my-zsh.sh",
        "{{template_dir}}/../../scripts/ubuntu/docker.sh",
        "{{template_dir}}/../../scripts/common/compose.sh",
        "{{template_dir}}/../../scripts/common/dnsdock.sh",
        "{{template_dir}}/../../scripts/common/registry.sh"
      ]
  }],
  "post-processors": [
    [
      {
        "type": "vagrant",
        "output": "{{template_dir}}/package.box",
        "keep_input_artifact": false
      }
    ]
  ]
}